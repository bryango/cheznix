From 2307b8f76f194241c523a257fc93bf7536dc8fe5 Mon Sep 17 00:00:00 2001
From: Doron Behar <doron.behar@gmail.com>
Date: Wed, 27 Nov 2024 09:20:02 +0200
Subject: [PATCH 1/2] {,python31{1,2}Packages}.hydra-check: remove

---
 .../python-modules/hydra-check/default.nix    | 45 -------------------
 pkgs/top-level/all-packages.nix               |  2 -
 pkgs/top-level/python-aliases.nix             |  1 +
 pkgs/top-level/python-packages.nix            |  2 -
 4 files changed, 1 insertion(+), 49 deletions(-)
 delete mode 100644 pkgs/development/python-modules/hydra-check/default.nix

diff --git a/pkgs/development/python-modules/hydra-check/default.nix b/pkgs/development/python-modules/hydra-check/default.nix
deleted file mode 100644
index ab9c197113d6d..0000000000000
--- a/pkgs/development/python-modules/hydra-check/default.nix
+++ /dev/null
@@ -1,45 +0,0 @@
-{
-  lib,
-  buildPythonPackage,
-  pythonOlder,
-  fetchFromGitHub,
-  poetry-core,
-  requests,
-  beautifulsoup4,
-  colorama,
-}:
-
-buildPythonPackage rec {
-  pname = "hydra-check";
-  version = "1.3.5";
-  format = "pyproject";
-
-  disabled = pythonOlder "3.10";
-
-  src = fetchFromGitHub {
-    owner = "nix-community";
-    repo = pname;
-    rev = "refs/tags/v${version}";
-    hash = "sha256-fRSC+dfZZSBBeN6YidXRKc1kPUbBKz5OiFSHGOSikgI=";
-  };
-
-  nativeBuildInputs = [ poetry-core ];
-  propagatedBuildInputs = [
-    colorama
-    requests
-    beautifulsoup4
-  ];
-
-  pythonImportsCheck = [ "hydra_check" ];
-
-  meta = with lib; {
-    description = "check hydra for the build status of a package";
-    mainProgram = "hydra-check";
-    homepage = "https://github.com/nix-community/hydra-check";
-    license = licenses.mit;
-    maintainers = with maintainers; [
-      makefu
-      artturin
-    ];
-  };
-}
diff --git a/pkgs/top-level/all-packages.nix b/pkgs/top-level/all-packages.nix
index 42f40a1b32b02..dfe8d754ff91c 100644
--- a/pkgs/top-level/all-packages.nix
+++ b/pkgs/top-level/all-packages.nix
@@ -9489,8 +9489,6 @@ with pkgs;
 
   hydra = callPackage ../by-name/hy/hydra/package.nix { nix = nixVersions.nix_2_24; };
 
-  hydra-check = with python3.pkgs; toPythonApplication hydra-check;
-
   icu-versions = callPackages ../development/libraries/icu { };
   inherit (icu-versions)
     icu60
diff --git a/pkgs/top-level/python-aliases.nix b/pkgs/top-level/python-aliases.nix
index ce73ec411b4a9..b8f5c046997c5 100644
--- a/pkgs/top-level/python-aliases.nix
+++ b/pkgs/top-level/python-aliases.nix
@@ -274,6 +274,7 @@ mapAliases ({
   htmllaundry = throw "htmllaundry has been removed because it is abandoned"; # added 2024-06-04
   HTSeq = htseq; # added 2023-02-19
   hyperkitty = throw "Please use pkgs.mailmanPackages.hyperkitty"; # added 2022-04-29
+  hydra-check = throw "The Python package hydra-check was removed in favor of the top-level rust based pkgs.hydra-check"; # added 2022-04-29
   ihatemoney = throw "ihatemoney was removed because it is no longer maintained downstream"; # added 2023-04-08
   IMAPClient = imapclient; # added 2021-10-28
   imdbpy = throw "imdbpy has been renamed to cinemagoer"; # added 2022-08-08
diff --git a/pkgs/top-level/python-packages.nix b/pkgs/top-level/python-packages.nix
index 7066958e5e224..1e1271c975174 100644
--- a/pkgs/top-level/python-packages.nix
+++ b/pkgs/top-level/python-packages.nix
@@ -6065,8 +6065,6 @@ self: super: with self; {
 
   hydra-core = callPackage ../development/python-modules/hydra-core { };
 
-  hydra-check = callPackage ../development/python-modules/hydra-check { };
-
   hydrawiser = callPackage ../development/python-modules/hydrawiser { };
 
   hydrogram = callPackage ../development/python-modules/hydrogram { };

From b01235edfa2d082339d22d14fa23eb841173021b Mon Sep 17 00:00:00 2001
From: Doron Behar <doron.behar@gmail.com>
Date: Wed, 27 Nov 2024 09:22:56 +0200
Subject: [PATCH 2/2] hydra-check: init at 2.0.1

---
 pkgs/by-name/hy/hydra-check/package.nix | 52 +++++++++++++++++++++++++
 1 file changed, 52 insertions(+)
 create mode 100644 pkgs/by-name/hy/hydra-check/package.nix

diff --git a/pkgs/by-name/hy/hydra-check/package.nix b/pkgs/by-name/hy/hydra-check/package.nix
new file mode 100644
index 0000000000000..11bd4c99373f0
--- /dev/null
+++ b/pkgs/by-name/hy/hydra-check/package.nix
@@ -0,0 +1,52 @@
+{
+  lib,
+  rustPlatform,
+  fetchFromGitHub,
+  pkg-config,
+  openssl,
+  stdenv,
+  installShellFiles,
+}:
+
+rustPlatform.buildRustPackage rec {
+  pname = "hydra-check";
+  version = "2.0.1";
+
+  src = fetchFromGitHub {
+    owner = "nix-community";
+    repo = "hydra-check";
+    rev = "v${version}";
+    hash = "sha256-QdCXToHNymOdlTyQjk9eo7LTznGKB+3pIOgjjaGoTXg=";
+  };
+
+  cargoHash = "sha256-iqFUMok36G1qSUbfY7WD6etY0dtfro3F7mLoOELzxbs=";
+
+  nativeBuildInputs = [
+    pkg-config
+    installShellFiles
+  ];
+
+  buildInputs = [
+    openssl
+  ];
+
+  postInstall = lib.optionalString (stdenv.buildPlatform.canExecute stdenv.hostPlatform) ''
+    installShellCompletion --cmd hydra-check \
+      --bash <($out/bin/hydra-check --shell-completion bash) \
+      --fish <($out/bin/hydra-check --shell-completion fish) \
+      --zsh <($out/bin/hydra-check --shell-completion zsh)
+  '';
+
+  meta = {
+    description = "Check hydra for the build status of a package";
+    homepage = "https://github.com/nix-community/hydra-check";
+    license = lib.licenses.mit;
+    maintainers = with lib.maintainers; [
+      makefu
+      artturin
+      bryango
+      doronbehar
+    ];
+    mainProgram = "hydra-check";
+  };
+}
